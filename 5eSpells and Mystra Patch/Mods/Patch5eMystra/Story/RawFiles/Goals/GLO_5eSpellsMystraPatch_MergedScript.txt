Version 1
SubGoalCombiner SGC_AND
INITSECTION
//REGION Old DB cleanup

SysClear("DB_S5E_ThunderStep", 1);
SysClear("DB_S5E_SteelWindStrike", 1);
SysClear("DB_S5E_RemoveFeeblemind", 1);
SysClear("DB_S5E_Ceremony", 1);
SysClear("DB_S5E_Ceremony_BlessWaterTemplate", 1);
SysClear("DB_ClericCantrip_Spell", 1);
SysClear("DB_SteelWindStrikeSpell", 1);
SysClear("DB_Mystras_Spells_Reaper_Cantrips", 1);
SysClear("DB_S5E_ThunderStep", 1);
SysClear("DB_S5E_ThunderStep", 1);
SysClear("DB_S5E_ThunderStep", 1);

//END_REGION

//REGION Databases

// Steel Wind Strike
DB_SteelWindStrike("Projectile_SteelWindStrike");
DB_SteelWindStrike("Projectile_SteelWindStrike_6");
DB_SteelWindStrike("Projectile_SteelWindStrike_7");
DB_SteelWindStrike("Projectile_SteelWindStrike_8");
DB_SteelWindStrike("Projectile_SteelWindStrike_9");

// Feeblemind removal
DB_RemoveFeeblemind("Target_Heal");
DB_RemoveFeeblemind("Target_Heal_6");
DB_RemoveFeeblemind("Target_Heal_7");
DB_RemoveFeeblemind("Target_Heal_8");
DB_RemoveFeeblemind("Target_Heal_9");
DB_RemoveFeeblemind("Target_GreaterRestoration");
DB_RemoveFeeblemind("Target_GreaterRestoration_6");
DB_RemoveFeeblemind("Target_GreaterRestoration_7");
DB_RemoveFeeblemind("Target_GreaterRestoration_8");
DB_RemoveFeeblemind("Target_GreaterRestoration_9");

//END_REGION

//REGION Adding in all Ceremony spells to the 5eSpells DB

DB_CeremonySpell("Target_Atonement");
DB_CeremonySpell("Target_Atonement_2");
DB_CeremonySpell("Target_Atonement_3");
DB_CeremonySpell("Target_Atonement_4");
DB_CeremonySpell("Target_Atonement_5");
DB_CeremonySpell("Target_Atonement_6");
DB_CeremonySpell("Target_Atonement_7");
DB_CeremonySpell("Target_Atonement_8");
DB_CeremonySpell("Target_Atonement_9");
DB_CeremonySpell("Target_BlessWater");
DB_CeremonySpell("Target_BlessWater_2");
DB_CeremonySpell("Target_BlessWater_3");
DB_CeremonySpell("Target_BlessWater_4");
DB_CeremonySpell("Target_BlessWater_5");
DB_CeremonySpell("Target_BlessWater_6");
DB_CeremonySpell("Target_BlessWater_7");
DB_CeremonySpell("Target_BlessWater_8");
DB_CeremonySpell("Target_BlessWater_9");
DB_CeremonySpell("Target_ComingOfAge");
DB_CeremonySpell("Target_ComingOfAge_2");
DB_CeremonySpell("Target_ComingOfAge_3");
DB_CeremonySpell("Target_ComingOfAge_4");
DB_CeremonySpell("Target_ComingOfAge_5");
DB_CeremonySpell("Target_ComingOfAge_6");
DB_CeremonySpell("Target_ComingOfAge_7");
DB_CeremonySpell("Target_ComingOfAge_8");
DB_CeremonySpell("Target_ComingOfAge_9");
DB_CeremonySpell("Target_Dedication");
DB_CeremonySpell("Target_Dedication_2");
DB_CeremonySpell("Target_Dedication_3");
DB_CeremonySpell("Target_Dedication_4");
DB_CeremonySpell("Target_Dedication_5");
DB_CeremonySpell("Target_Dedication_6");
DB_CeremonySpell("Target_Dedication_7");
DB_CeremonySpell("Target_Dedication_8");
DB_CeremonySpell("Target_Dedication_9");
DB_CeremonySpell("Target_FuneralRite");
DB_CeremonySpell("Target_FuneralRite_2");
DB_CeremonySpell("Target_FuneralRite_3");
DB_CeremonySpell("Target_FuneralRite_4");
DB_CeremonySpell("Target_FuneralRite_5");
DB_CeremonySpell("Target_FuneralRite_6");
DB_CeremonySpell("Target_FuneralRite_7");
DB_CeremonySpell("Target_FuneralRite_8");
DB_CeremonySpell("Target_FuneralRite_9");
DB_CeremonySpell("Target_Wedding");
DB_CeremonySpell("Target_Wedding_2");
DB_CeremonySpell("Target_Wedding_3");
DB_CeremonySpell("Target_Wedding_4");
DB_CeremonySpell("Target_Wedding_5");
DB_CeremonySpell("Target_Wedding_6");
DB_CeremonySpell("Target_Wedding_7");
DB_CeremonySpell("Target_Wedding_8");
DB_CeremonySpell("Target_Wedding_9");

DB_CeremonySpell_BlessWaterTemplate((ITEMROOT)_640302a8-d841-44d6-996d-2addda644306);
DB_CeremonySpell_BlessWaterTemplate((ITEMROOT)_00253e1b-375c-4ef4-8808-974cab615ff7);
DB_CeremonySpell_BlessWaterTemplate((ITEMROOT)_d8fff9cf-05b9-4aeb-b5b4-0f6bb98b7f2c);
DB_CeremonySpell_BlessWaterTemplate((ITEMROOT)_e8e427ac-9078-4471-85f2-4b8bbc3e00b5);
DB_CeremonySpell_BlessWaterTemplate((ITEMROOT)_6f5abf98-cca0-43a7-a064-10c17643bb72);
DB_CeremonySpell_BlessWaterTemplate((ITEMROOT)_94f1d6d2-8a70-4ab9-a8cf-376dd0bc294a);
DB_CeremonySpell_BlessWaterTemplate((ITEMROOT)_cb2e851f-8a75-4899-b705-0f079e8e55bc);

//END_REGION

KBSECTION
//REGION Ceremony

IF
GoldChanged(_,_)
AND
DB_Players(_Character)
AND
PartyGetGold(_Character,_Gold)
AND
_Gold > 24
AND
HasActiveStatus(_Character,"CEREMONY_GOLD_COST",0)
THEN
ApplyStatus(_Character,"CEREMONY_GOLD_COST",-1.0,1,_Character);

IF
GoldChanged(_,_)
AND
DB_Players(_Character)
AND
PartyGetGold(_Character,_Gold)
AND
_Gold < 25
AND
HasActiveStatus(_Character,"CEREMONY_GOLD_COST",1)
THEN
RemoveStatus(_Character,"CEREMONY_GOLD_COST");

IF
LevelGameplayStarted("SYS_CC_I",_)
AND
DB_Players(_Character)
AND
PartyGetGold(_Character,_Gold)
AND
_Gold > 24
AND
HasActiveStatus(_Character,"CEREMONY_GOLD_COST",0)
THEN
ApplyStatus(_Character,"CEREMONY_GOLD_COST",-1.0,1,_Character);

IF
LevelGameplayStarted("SYS_CC_I",_)
AND
DB_Players(_Character)
AND
PartyGetGold(_Character,_Gold)
AND
_Gold < 25
AND
HasActiveStatus(_Character,"CEREMONY_GOLD_COST",1)
THEN
RemoveStatus(_Character,"CEREMONY_GOLD_COST");

IF
LeveledUp(_)
AND
DB_Players(_Character)
AND
PartyGetGold(_Character,_Gold)
AND
_Gold > 24
AND
HasActiveStatus(_Character,"CEREMONY_GOLD_COST",0)
THEN
ApplyStatus(_Character,"CEREMONY_GOLD_COST",-1.0,1,_Character);

IF
LeveledUp(_)
AND
DB_Players(_Character)
AND
PartyGetGold(_Character,_Gold)
AND
_Gold < 25
AND
HasActiveStatus(_Character,"CEREMONY_GOLD_COST",1)
THEN
RemoveStatus(_Character,"CEREMONY_GOLD_COST");

IF
CastedSpell((CHARACTER)_Character,_Spell,_,_,_)
AND
DB_CeremonySpell(_Spell)
THEN
PartyAddGold(_Character,-25);
ApplyStatus((CHARACTER)_Character,"GOLD_COST_PROC",6.0,0);

IF
StatusApplied((CHARACTER)_Character,"GOLD_COST_PROC",_,_)
AND
DB_Players(_Character)
AND
PartyGetGold(_Character,_Gold)
AND
_Gold > 24
AND
HasActiveStatus(_Character,"CEREMONY_GOLD_COST",0)
THEN
ApplyStatus(_Character,"CEREMONY_GOLD_COST",-1.0,0);

IF
StatusApplied((CHARACTER)_Character,"GOLD_COST_PROC",_,_)
AND
DB_Players(_Character)
AND
PartyGetGold(_Character,_Gold)
AND
_Gold < 25
AND
HasActiveStatus(_Character,"CEREMONY_GOLD_COST",1)
THEN
RemoveStatus(_Character,"CEREMONY_GOLD_COST");

IF
StatusApplied((CHARACTER)_Character,"CEREMONY_BLESSED_WATER",_,_)
AND
DB_CeremonySpell_BlessWaterTemplate(_Template)
AND
GetItemByTemplateInInventory(_Template,_Character,_Water)
THEN
TemplateAddTo((ITEMROOT)_edabfdca-3371-405f-8358-850718a61fdb,_Character,1,1);
TemplateRemoveFromUser(_Template,_Character,1);

//END_REGION

//REGION Steel Wind Strike

IF
StartedPreviewingSpell(_Character, _Spell, _, _)
AND
DB_SteelWindStrike(_Spell)
AND
GetPosition(_Character,_X,_Y,_Z)
THEN
DB_SteelWindStrikePosition(_Character,_X,_Y,_Z);

IF
CastedSpell(_Character, _Spell, _, _, _)
AND
DB_SteelWindStrike(_Spell)
AND
DB_SteelWindStrikePosition(_Character,_X,_Y,_Z)
THEN
RealtimeObjectTimerLaunch(_Character, "SteelWindStrikeTimer", 100);

IF
ObjectTimerFinished(_Character, "SteelWindStrikeTimer")
AND
DB_SteelWindStrikePosition(_Character,_X,_Y,_Z)
THEN
TeleportToPosition(_Character,_X,_Y,_Z,"",0,0,0,0,1);

//END_REGION

//REGION Feeblemind

IF
UsingSpellOnTarget(_Character,_Target,_Spell,_,_,_)
AND
DB_RemoveFeeblemind(_Spell)
THEN
RemoveStatus(_Target,"FEEBLEMIND",_Character);

IF
UsingSpellOnTarget(_Character,_Target,_Spell,_,_,_)
AND
DB_RemoveFeeblemind(_Spell)
THEN
RemoveStatus(_Target,"FEEBLEMIND",_Character);

//END_REGION

EXITSECTION

ENDEXITSECTION
